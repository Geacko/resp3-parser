#!/usr/bin/env -S deno run --allow-env

import { Resp3DecoderStream } from "../mod.ts";

const source = new TextEncoder().encode([
    '|?',
    '+name',
    '$7',
    'name #0',
    '+popularity',
    ',0.5',
    '+previous',
    ':0',
    '+is_primary',
    '#t',
    '+related_keys',
    '~?',
    ':2',
    ':1',
    '.',
    '.',
    '%?',
    '+0',
    '=?',
    ';3',
    'txt',
    ';1',
    ':',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';0',
    '+1',
    '=?',
    ';3',
    'txt',
    ';1',
    ':',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';0',
    '+2',
    '=?',
    ';3',
    'txt',
    ';1',
    ':',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';0',
    '.',
    '|?',
    '+name',
    '$7',
    'name #1',
    '+popularity',
    ',0.25',
    '+previous',
    ':1',
    '+is_primary',
    '#f',
    '+related_keys',
    '~?',
    ':0',
    ':8',
    ':1',
    ':5',
    ':2',
    '.',
    '.',
    '%?',
    '+0',
    '=?',
    ';3',
    'txt',
    ';1',
    ':',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';0',
    '+1',
    '=?',
    ';3',
    'txt',
    ';1',
    ':',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';0',
    '+2',
    '=?',
    ';3',
    'txt',
    ';1',
    ':',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';0',
    '.',
    '|?',
    '+name',
    '$7',
    'name #2',
    '+popularity',
    ',0.125',
    '+previous',
    ':2',
    '+is_primary',
    '#f',
    '+related_keys',
    '~?',
    ':7',
    '.',
    '.',
    '%?',
    '+0',
    '=?',
    ';3',
    'txt',
    ';1',
    ':',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';0',
    '+1',
    '=?',
    ';3',
    'txt',
    ';1',
    ':',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';0',
    '+2',
    '=?',
    ';3',
    'txt',
    ';1',
    ':',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';10',
    'xxxxxxxxxx',
    ';0',
    '.',
].join('\r\n') + '\r\n')

const size = 10
const blob = [
    // ...
] as Uint8Array[]

for (let i = 0; i < source.byteLength; i += size) {
    blob.push(source.subarray(i, i + size))
}

const readable = new Blob(blob).stream().pipeThrough(new Resp3DecoderStream())

for await (const x of readable) {
    console.log(x)
}
